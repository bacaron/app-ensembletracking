#!/bin/bash
#PBS -l nodes=1:ppn=8:dc2,walltime=9:30:00
#PBS -N ensembletracking
#PBS -V
#PBS -o stdout.$PBS_JOBID.log
#PBS -e stderr.$PBS_JOBID.log

#if [ $ENV == "IUHPC" ]; then
#    module load mrtrix/0.2.12
#    module load freesurfer/6.0.0
#    module load matlab
#    module load python
#fi

#if [ $ENV == "VM" ]; then
#    export FREESURFER_HOME=/usr/local/freesurfer
#    source $FREESURFER_HOME/SetUpFreeSurfer.sh
#fi

which module && module load singularity

fsurfer=`jq -r '.freesurfer' config.json`

#convert aparc+aseg.mgz to wm.nii.gz 
singularity exec -e docker://brainlife/freesurfer /usr/local/freesurfer/bin/mri_convert --out_orientation RAS $fsurfer/mri/apar+aseg.mgz wm.nii.gz


#tracking 

singularity exec -e docker://

if [ -s track.tck ]
then
	echo 0 > finished
else
	echo "ensemble tracking missing"
	echo 1 > finished
	exit 1
fi

